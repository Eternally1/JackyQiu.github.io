---
title: 贝叶斯公式和最大似然估计
date: 2018-09-15 16:24:28
categories:
- Algorithm
tags:
- Algorithm
- Bayes
- 全概率公式
- 最大似然估计
mathjax: true
---

# 引言
总结整理贝叶斯公式相关理论知识。

# 1 贝叶斯公式
*经典贝叶斯公式*：$P(A|B) = \frac{P(B|A)P(A)}{P(B)}$，其中P(A)为先验概率，即在得到新数据前某一假设的概率；P(B|A)是似然度，即在该假设下得到这一数据的概率；P(A|B)是后验概率，即在观察到新数据后计算该假设的概率；P(B)为标准化常量，即在任何假设下得到这一数据的概率。

*条件概率*是指事件A在另外一个事件B已经发生条件下的发生概率，公式如下: $P(A|B) = \frac{P(AB)}{P(B)}$

*全概率公式*为概率论中的重要公式，它将对一复杂事件A的概率求解问题转化为了在不同情况下发生的简单事件的概率的求和问题。如果事件$B_1,B_2,...B_n$构成一个完备事件组，即他们两两互不相容，其和为全集，并且$P(B_i)$大于0，则对于事件A有如下公式成立：

$$
P(A) = P(AB_1)+P(AB_2)+...+P(AB_n)= P(A|B_1)P(B1)+...+P(A|B_n)P(B_n) \\
= \sum_{i=1}^nP(B_i)P(A|B_i)
$$
其中省略了一些推导过程。
关于*完备事件组*，设S为试验E的样本空间，B1，B2，…，Bn为E的一组事件。若(i)Bi ∩ Bj=∅ （i≠j且i、j=1，2，…，n）；(ii)B1∪B2∪…∪Bn=S，则称B1，B2，…，Bn为样本空间S的一个完备事件组。

# 1.1 一个栗子
在夏季，某公园男性穿凉鞋的概率为1/2，女性穿凉鞋的概率为2/3，并且该公园中男女比例通常为2:1，问题：若你在公园中随机遇到一个穿凉鞋的人，请问他的性别为男性或女性的概率分别为多少？

首先，可以设 A = 男性， B = 女性， X = 穿凉鞋；通过分析，已知两个条件概率P(X|A) = 1/2, P(X|B) = 2/3,先验概率P(A) = 2/3,P(B) = 1/3。根据贝叶斯公式，要计算P(A|X),P(B|X)。

$$
P(A|X) = \frac{P(X|A)P(A)}{P(X)}
$$
根据上述式子可以发现，分母P(X)无法求得，而分析题目可知A,B构成一个完备事件组，因此可以使用全概率公式:$P(X) = P(X|A)P(A)+P(X|B)P(B)$，计算求得值为5/9，再结合上式子，可得：$P(A|X) = \frac{\frac 1 2* \frac 2 3}{\frac 5 9} = \frac 3 5$。

# 2 极大似然估计
## 2.1 问题引出
在实际问题中，我能能获得的数据可能只有有限数目的样本数据，而先验概率P(A)和似然度P(X|A)都是未知的。根据仅有的样本数据进行分类的时候，一种可行的方法就是先对先验概率和似然度进行估计，之后就可以套用贝叶斯分类器。

- 先验概率的估计：这个比较简单，可以直接依靠经验、或者使用训练样本中各类出现的频率估计。（比如上面的问题，可以依据经验估计男女比例1:1）
- 似然度估计比较难，概率密度函数包含了一个随机变量的全部信息；样本数据可能不多；特征向量x的维度可能很大等等。总之要直接估计类条件概率的密度函数很难。解决的办法就是，把估计完全未知的概率密度转化为估计参数。这里就将概率密度估计问题转化为参数估计问题，极大似然估计就是一种参数估计方法。当然了，概率密度函数的选取很重要，模型正确，在样本区域无穷时，我们会得到较准确的估计值，如果模型都错了，那估计半天的参数，肯定也没啥意义了。

### 前提
参数估计问题只是实际问题求解过程中的一种简化方法（由于直接估计条件概率密度函数很困难），所以能够使用极大似然估计方法的样本必须要满足一个假设：训练样本的分析能够代表真是分布，每个样本符合独立同分布。

## 2.2 原理
极大似然估计是利用已知的样本的分布，在使用某个模型的基础上，反推出最有可能导致这样结果的模型参数值。即模型已定，参数未知的方法。

假设我们有一个随机样本序列*X1,X2,...Xn*, 每一个*Xi*的概率（质量）分布函数是 $f(x_i; \theta)$，因此，$X_1, X_2,...X_n$的联合概率密度（质量）函数$L(\theta)$： 

$$
L(\theta) = P(X_1=x_1,X_2 = x_2,...X_n=x_n) \\ 
= f(x_1;\theta)f(x_2;\theta)...f(x_n,\theta) = \prod_{i=1}^Nf(x_i;\theta)
$$

上面的公式中，第一个等号是联合概率密度函数的定义，第二个等号是因为我们定义了$X_i$是独立的。现在，根据最大似然估计的思想，一个合理的方式是将$L(\theta)$看做是$\theta$的函数，并寻找一个$\theta$让$L(\theta)$的值最大。

### 2.2.1 0-1分布
假设一个袋子装有白球与红球，比例未知，现在抽取10次（每次抽完都放回，保证事件独立性），假设抽到了7次白球和3次红球，在此数据样本条件下，可以采用最大似然估计法求解袋子中白球的比例。

首先，假设该模型的参数是$\theta$，样本的分布函数为$f(x_i;\theta)$。在上面这个例子中，可以较为清晰的看出是符合0-1分布的，那么*模型的参数其实就可以理解为抽到白球的概率为$\theta$*。

$$
L(\theta) = P(X_1=x_1,X_2 = x_2,...X_n=x_n) = \theta^7(1-\theta)^3 
$$
对联合概率密度函数求ln函数并求平均似然，之后求导并令导数为0。

$$
\hat{L} = ln(\theta) = ln[\theta^7(1-\theta)^3] \\
{\hat{L}}^\prime = 7\theta^6(1-\theta)^3-3\theta^7(1-\theta)^2 = 0 \\
\theta = 0.7
$$
上面的求导中，省略了分母部分的值。  
总结：这个例子是符合0-1分布的例子，因此模型的参数$\theta$也就可以理解为抽到白球的概率。

### 2.2.2 正态分布

假设随机选择的学生体重符合未知均值$\mu$和标准差$\sigma$正态分布，随机抽样的10名学生的体重值如下： 115  122  130  127  149  160  152  138  149  180，求$\mu$的最大似然估计，即学生的平均体重。

首先，$X_i$的概率密度函数是：

$$
f(x_i;\mu,\sigma^2) = \frac{1}{\sigma \sqrt{2\pi}}exp\left[-\frac{(x_i-\mu)^2}{2\sigma^2}\right]
$$  
之后，求联合概率密度函数，也即是似然函数：（具体的公式推导就不展开了）

$$
L(\mu, \sigma) = \sigma^{-n}(2\pi)^{-n/2}exp\left[-\frac{1}{2\sigma^2}\sum_{i=1}^n(x_i-\mu)^2\right]
$$
通过一些处理方法，比如对$L(\theta)$求log函数，然后再对$\mu$求偏导，并令偏导数为0，得到$\mu$的最大似然估计如下:

$$
\hat\mu = \frac{1}{n}\sum_{i=1}^{n}X_i = \bar{X}
$$
然后，基于给定的样本数据，得到$\mu$的最大似然估计如下:

$$
\hat\mu = \frac{1}{n}\sum_{i=1}^{n}x_i = \frac 1 {10}(115+122+...+180) = 142.2
$$






